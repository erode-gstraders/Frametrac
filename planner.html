<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FRAMETRAC — Planner</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="index.html">FRAMETRAC</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link active" href="planner.html">Planner</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Reports</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Settings</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container py-5">

        <!-- HEADER -->
        <div class="d-flex flex-wrap align-items-center justify-content-between mb-4">
            <div>
                <h2 class="fw-bold mb-0">Planner</h2>
                <p class="text-muted mb-0">Plan and manage your content pipeline</p>
            </div>
            <div class="d-flex">
                <button class="btn btn-primary rounded-pill me-2" data-bs-toggle="modal"
                    data-bs-target="#addContentModal" id="addContentBtn">+ Add Content</button>
                <button class="btn btn-outline-light rounded-pill me-2" id="exportBtn">Save JSON</button>
                <button class="btn btn-outline-light rounded-pill" id="loadBtn">Load JSON</button>
                <button class="btn btn-outline-danger rounded-pill ms-2" id="clearBtn">Clear JSON</button>

            </div>
        </div>

        <!-- FILTERS -->
        <div class="mb-4">
            <button class="btn btn-outline-light rounded-pill me-2 filter-btn active" data-filter="All">All</button>
            <button class="btn btn-outline-light rounded-pill me-2 filter-btn" data-filter="Reel">Reels</button>
            <button class="btn btn-outline-light rounded-pill me-2 filter-btn" data-filter="Video">Videos</button>
        </div>

        <!-- CONTENT GRID -->
        <div class="row g-4" id="contentGrid">
            <!-- Cards will be injected here -->
        </div>

    </main>

    <footer class="py-4 mt-5 text-center">
        <div class="small text-muted">
            © <span id="year"></span> FRAMETRAC — All Rights Reserved
        </div>
    </footer>

    <!-- ADD CONTENT MODAL -->
    <div class="modal fade" id="addContentModal" tabindex="-1" aria-labelledby="addContentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title" id="addContentModalLabel">Add New Content</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="contentForm">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control bg-secondary text-white" id="titleInput"
                                placeholder="Content title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Genre</label>
                            <select class="form-select bg-secondary text-white" id="genreInput">
                                <option>Reel</option>
                                <option>Video</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select bg-secondary text-white" id="statusInput">
                                <option>Planned</option>
                                <option>Scripting</option>
                                <option>Filming</option>
                                <option>Editing</option>
                                <option>Ready</option>
                                <option>Published</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="createdOnInput" class="form-label">Created On</label>
                            <input type="date" class="form-control" id="createdOnInput" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="deadlineInput" class="form-label">Deadline</label>
                            <input type="date" class="form-control" id="deadlineInput">
                        </div>

                        <button type="submit" class="btn btn-primary rounded-pill w-100">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // ===== STORAGE =====
        const STORAGE_KEY = 'framedata';
        let contentItems = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        const contentGrid = document.getElementById('contentGrid');

        let editIndex = null;

        const createdOnInput = document.getElementById('createdOnInput');
        const deadlineInput = document.getElementById('deadlineInput');

        // ===== DEFAULT DATES =====
        function setDefaultDates(isEdit = false, item = null) {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            if (isEdit && item) {
                createdOnInput.value = item.createdOn;
                deadlineInput.value = item.deadline;
            } else {
                createdOnInput.value = todayStr;
                const defaultDeadline = new Date();
                defaultDeadline.setDate(defaultDeadline.getDate() + 60);
                deadlineInput.value = defaultDeadline.toISOString().split('T')[0];
            }
        }

        // ===== RENDER CARDS =====
        function renderCards(filter = 'All') {
            contentGrid.innerHTML = '';
            contentItems.filter(item => filter === 'All' || item.genre === filter)
                .forEach((item, index) => {
                    const badgeClass =
                        item.status === 'Planned' ? 'badge-planned' :
                            item.status === 'Scripting' ? 'badge-scripting' :
                                item.status === 'Filming' ? 'badge-filming' :
                                    item.status === 'Editing' ? 'badge-editing' :
                                        item.status === 'Ready' ? 'badge-ready' :
                                            item.status === 'Published' ? 'badge-published' : 'badge-secondary';

                    contentGrid.innerHTML += `
      <div class="col-md-4">
        <div class="card content-card" data-index="${index}">
          <div class="card-body">
            <h6 class="fw-bold mb-1">${item.title}</h6>
            <p class="text-muted small mb-2">Genre: ${item.genre}</p>
            <span class="badge ${badgeClass} mb-2">${item.status}</span>
            <p class="small text-muted mb-0">Created On: ${item.createdOn}</p>
            <p class="small text-muted">Deadline: ${item.deadline}</p>
          </div>
        </div>
      </div>`;
                });
            enableCardEditing();
        }

        renderCards();

        // ===== FILTERS =====
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCards(btn.dataset.filter);
            });
        });

        // ===== ADD CONTENT BUTTON =====
        document.getElementById('addContentBtn').addEventListener('click', () => {
            editIndex = null;
            setDefaultDates(false);
        });

        // ===== ADD / EDIT CONTENT =====
        const contentForm = document.getElementById('contentForm');
        contentForm.addEventListener('submit', e => {
            e.preventDefault();

            let createdOn = createdOnInput.value;
            if (!createdOn) {
                createdOn = new Date().toISOString().split('T')[0];
            }

            let deadline = deadlineInput.value;
            if (!deadline) {
                const defaultDeadline = new Date();
                defaultDeadline.setDate(new Date(createdOn).getDate() + 60);
                deadline = defaultDeadline.toISOString().split('T')[0];
            }

            const newItem = {
                title: document.getElementById('titleInput').value,
                genre: document.getElementById('genreInput').value,
                status: document.getElementById('statusInput').value,
                createdOn: createdOn,
                deadline: deadline
            };

            if (editIndex === null) {
                contentItems.push(newItem);
            } else {
                contentItems[editIndex] = newItem;
                editIndex = null;
            }

            localStorage.setItem(STORAGE_KEY, JSON.stringify(contentItems));
            renderCards(document.querySelector('.filter-btn.active').dataset.filter);
            contentForm.reset();
            bootstrap.Modal.getInstance(document.getElementById('addContentModal')).hide();
        });

        // ===== CARD EDITING =====
        function enableCardEditing() {
            document.querySelectorAll('.content-card').forEach(card => {
                card.onclick = () => {
                    editIndex = parseInt(card.dataset.index);
                    const item = contentItems[editIndex];

                    document.getElementById('titleInput').value = item.title;
                    document.getElementById('genreInput').value = item.genre;
                    document.getElementById('statusInput').value = item.status;

                    setDefaultDates(true, item);
                    const modal = new bootstrap.Modal(document.getElementById('addContentModal'));
                    modal.show();
                };
            });
        }

        // ===== EXPORT JSON =====
        document.getElementById('exportBtn').addEventListener('click', () => {
            const dataStr = JSON.stringify(contentItems, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'planner.json';
            a.click();

            URL.revokeObjectURL(url);
            alert('Planner data exported successfully!');
        });

        // ===== LOAD JSON =====
        document.getElementById('loadBtn').addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        contentItems = JSON.parse(event.target.result);
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(contentItems));
                        renderCards(document.querySelector('.filter-btn.active').dataset.filter);
                        alert('Planner data loaded!');
                    } catch {
                        alert('Invalid JSON file!');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        });

        // ===== CLEAR JSON =====
        document.getElementById('clearBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all content? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY); // remove all saved content
                contentItems = []; // reset array
                renderCards(); // refresh grid
                alert('All content cleared!');
            }
        });

    </script>

</body>

</html>