<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FRAMETRAC — Dashboard</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- ===== NAVBAR ===== -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="index.html">FRAMETRAC</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="planner.html">Planner</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Reports</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Settings</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ===== MAIN DASHBOARD CONTENT ===== -->
    <main class="container py-5">

        <!-- HEADER -->
        <div class="mb-5">
            <h2 class="fw-bold mb-0">Dashboard</h2>
            <p class="text-muted mb-0">Overview of your content pipeline</p>
        </div>

        <!-- TOP STAT CARDS -->
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Total Content</h6>
                        <h3 class="fw-bold">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Reels</h6>
                        <h3 class="fw-bold">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Videos</h6>
                        <h3 class="fw-bold">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Published</h6>
                        <h3 class="fw-bold">0</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- STAGES OVERVIEW CARDS -->
        <div class="row g-4 mb-5">
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Planned</h6>
                    <h4>0</h4>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Scripting</h6>
                    <h4>0</h4>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Filming</h6>
                    <h4>0</h4>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Editing</h6>
                    <h4>0</h4>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Ready</h6>
                    <h4>0</h4>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stage-card text-center">
                    <h6>Published</h6>
                    <h4>0</h4>
                </div>
            </div>
        </div>

        <!-- RECENT CONTENT CARDS -->
        <div class="row g-4" id="recentContent">
            <!-- Cards will be dynamically populated from planner.json/localStorage -->
        </div>

    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="py-4 mt-5 text-center">
        <div class="small text-muted">
            © <span id="year"></span> FRAMETRAC — All Rights Reserved
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ===== JSON / LOCALSTORAGE LOGIC ===== -->
    <!-- ===== JSON / LOCALSTORAGE LOGIC ===== -->
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        const STORAGE_KEY = 'framedata';
        let contentItems = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // Update top stats
        function updateStats() {
            const total = contentItems.length;
            const reels = contentItems.filter(i => i.genre === 'Reel').length;
            const videos = contentItems.filter(i => i.genre === 'Video').length;
            const published = contentItems.filter(i => i.status === 'Published').length;

            const statCards = document.querySelectorAll('.stat-card h3');
            statCards[0].textContent = total;
            statCards[1].textContent = reels;
            statCards[2].textContent = videos;
            statCards[3].textContent = published;

            const stages = ['Planned', 'Scripting', 'Filming', 'Editing', 'Ready', 'Published'];
            stages.forEach((stage, index) => {
                const count = contentItems.filter(i => i.status === stage).length;
                document.querySelectorAll('.stage-card h4')[index].textContent = count;
            });
        }

        // Render recent content
        function renderRecentContent() {
            const container = document.getElementById('recentContent');
            container.innerHTML = '';
            contentItems.forEach(item => {
                // Determine badge class
                const badgeClass =
                    item.status === 'Planned' ? 'badge-planned' :
                        item.status === 'Scripting' ? 'badge-scripting' :
                            item.status === 'Filming' ? 'badge-filming' :
                                item.status === 'Editing' ? 'badge-editing' :
                                    item.status === 'Ready' ? 'badge-ready' :
                                        item.status === 'Published' ? 'badge-published' : 'badge-secondary';

                // Default Created On = today if missing
                let createdOn = item.createdOn ? item.createdOn : new Date().toISOString().split('T')[0];

                // Default Deadline = 60 days from Created On if missing
                let deadline = item.deadline;
                if (!deadline) {
                    const d = new Date(createdOn);
                    d.setDate(d.getDate() + 60);
                    deadline = d.toISOString().split('T')[0];
                }

                // Display Publish as '-' if missing
                const publishText = item.publish ? item.publish : '-';

                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
                <div class="card content-card">
                    <div class="card-body">
                        <h6 class="fw-bold mb-1">${item.title}</h6>
                        <p class="text-muted small mb-2">Genre: ${item.genre}</p>
                        <span class="badge ${badgeClass} mb-2">${item.status}</span>
                        <p class="small text-muted mb-0">Created On: ${createdOn}</p>
                        <p class="small text-muted mb-0">Deadline: ${deadline}</p>
                    </div>
                </div>`;
                container.appendChild(col);
            });
        }

        // Initial render
        updateStats();
        renderRecentContent();
    </script>

</body>

</html>